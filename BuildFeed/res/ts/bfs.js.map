{"version":3,"sources":["bfs.ts"],"names":["BuildFeed","MobileMenuToggle","ev","preventDefault","button","this","nextElementSibling","classList","toggle","DropdownClick","link","parentElement","SwitchTheme","document","cookie","dataset","location","reload","SwitchLanguage","OpenSearch","modal","getElementById","add","CloseSearch","remove","StopClick","stopPropagation","InitiateSearch","resultPane","innerHTML","clearTimeout","timeout","ajax","readyState","XMLHttpRequest","DONE","abort","setInterval","SendSearch","modalInput","onreadystatechange","CompleteSearch","open","value","setRequestHeader","send","status","templateContent","template","jsrender","templates","content","render","JSON","parse","responseText","resultLinks","getElementsByTagName","i","length","addEventListener","mev","ga","assign","currentTarget","href","BuildFeedSetup","ddParents","getElementsByClassName","j","childNodes","el","nodeName","ddThemes","ddLangs","btnNav","btnSearch","modalOverlay","modalDialog","window"],"mappings":"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","file":"bfs.js","sourcesContent":["/// <reference path=\"../../scripts/typings/google.analytics/ga.d.ts\" />\r\n/// <reference path=\"../../scripts/typings/jsrender/jsrender.d.ts\" />\r\n\"use strict\";\r\n\r\nmodule BuildFeed\r\n{\r\n   let ajax: XMLHttpRequest;\r\n   let timeout: number;\r\n\r\n   export function MobileMenuToggle(ev: MouseEvent)\r\n   {\r\n      ev.preventDefault();\r\n\r\n      const button = this as HTMLButtonElement;\r\n      button.nextElementSibling.classList.toggle(\"open\");\r\n   }\r\n\r\n   export function DropdownClick(ev: MouseEvent)\r\n   {\r\n      ev.preventDefault();\r\n\r\n      const link = this as HTMLAnchorElement;\r\n      link.parentElement.classList.toggle(\"open\");\r\n   }\r\n\r\n   export function SwitchTheme(ev: MouseEvent)\r\n   {\r\n      ev.preventDefault();\r\n\r\n      const link = this as HTMLAnchorElement;\r\n      document.cookie = `bf_theme=${link.dataset[\"theme\"]}; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/`;\r\n      location.reload(true);\r\n   }\r\n\r\n   export function SwitchLanguage(ev: MouseEvent)\r\n   {\r\n      ev.preventDefault();\r\n\r\n      const link = this as HTMLAnchorElement;\r\n      document.cookie = `bf_lang=${link.dataset[\"lang\"]}; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/`;\r\n      location.reload(true);\r\n   }\r\n\r\n   export function OpenSearch(ev: MouseEvent)\r\n   {\r\n      ev.preventDefault();\r\n\r\n      const modal = document.getElementById(\"modal-search-overlay\") as HTMLDivElement;\r\n      modal.classList.add(\"open\");\r\n   }\r\n\r\n   export function CloseSearch(ev: MouseEvent)\r\n   {\r\n      ev.preventDefault();\r\n\r\n      const modal = document.getElementById(\"modal-search-overlay\") as HTMLDivElement;\r\n      modal.classList.remove(\"open\");\r\n   }\r\n\r\n   export function StopClick(ev: MouseEvent)\r\n   {\r\n      ev.preventDefault();\r\n      ev.stopPropagation();\r\n   }\r\n\r\n   export function InitiateSearch(ev: KeyboardEvent)\r\n   {\r\n      const resultPane = document.getElementById(\"modal-search-result\") as HTMLDivElement;\r\n      resultPane.innerHTML = \"\";\r\n\r\n      if (typeof (timeout) !== \"undefined\")\r\n      {\r\n         clearTimeout(timeout);\r\n      }\r\n\r\n      if (typeof (ajax) !== \"undefined\" && ajax.readyState !== XMLHttpRequest.DONE)\r\n      {\r\n         ajax.abort();\r\n      }\r\n\r\n      timeout = setInterval(SendSearch, 200);\r\n   }\r\n\r\n   export function SendSearch()\r\n   {\r\n      if (typeof (timeout) !== \"undefined\")\r\n      {\r\n         clearTimeout(timeout);\r\n      }\r\n\r\n      const modalInput = document.getElementById(\"modal-search-input\") as HTMLInputElement;\r\n\r\n      ajax = new XMLHttpRequest();\r\n      ajax.onreadystatechange = CompleteSearch;\r\n      ajax.open(\"GET\", `/api/GetSearchResult/${modalInput.value}/`, true);\r\n      ajax.setRequestHeader(\"accept\", \"application/json\");\r\n      ajax.send(null);\r\n   }\r\n\r\n   export function CompleteSearch(ev: ProgressEvent)\r\n   {\r\n      if (ajax.readyState !== XMLHttpRequest.DONE || ajax.status !== 200)\r\n      {\r\n         return;\r\n      }\r\n\r\n      const resultPane = document.getElementById(\"modal-search-result\") as HTMLDivElement;\r\n      const templateContent = document.getElementById(\"result-template\") as HTMLDivElement;\r\n      const template = jsrender.templates(templateContent.innerHTML);\r\n      const content = template.render(JSON.parse(ajax.responseText));\r\n      resultPane.innerHTML = content;\r\n\r\n      const resultLinks = resultPane.getElementsByTagName(\"a\");\r\n      for (let i = 0; i < resultLinks.length; i++)\r\n      {\r\n         resultLinks[i].addEventListener(\"click\", (mev: MouseEvent) =>\r\n         {\r\n            mev.preventDefault();\r\n            const modalInput = document.getElementById(\"modal-search-input\") as HTMLInputElement;\r\n            ga(\"send\", \"pageview\", `/api/GetSearchResult/${modalInput.value}/`);\r\n            location.assign((mev.currentTarget as HTMLAnchorElement).href);\r\n         });\r\n      }\r\n   }\r\n\r\n   export function BuildFeedSetup(ev: Event)\r\n   {\r\n      const ddParents = document.getElementsByClassName(\"dropdown-parent\");\r\n      for (let i = 0; i < ddParents.length; i++)\r\n      {\r\n         for (let j = 0; j < ddParents[i].childNodes.length; j++)\r\n         {\r\n            const el = ddParents[i].childNodes[j];\r\n\r\n            if (el.nodeName === \"A\")\r\n            {\r\n               el.addEventListener(\"click\", DropdownClick);\r\n            }\r\n         }\r\n      }\r\n\r\n      const ddThemes = document.getElementById(\"settings-theme-menu\").getElementsByTagName(\"a\");\r\n      for (let i = 0; i < ddThemes.length; i++)\r\n      {\r\n         ddThemes[i].addEventListener(\"click\", SwitchTheme);\r\n      }\r\n\r\n      const ddLangs = document.getElementById(\"settings-lang-menu\").getElementsByTagName(\"a\");\r\n      for (let i = 0; i < ddLangs.length; i++)\r\n      {\r\n         ddLangs[i].addEventListener(\"click\", SwitchLanguage);\r\n      }\r\n\r\n      const btnNav = document.getElementById(\"page-navigation-toggle\");\r\n      btnNav.addEventListener(\"click\", MobileMenuToggle);\r\n\r\n      const btnSearch = document.getElementById(\"page-navigation-search\");\r\n      btnSearch.addEventListener(\"click\", OpenSearch);\r\n\r\n      const modalOverlay = document.getElementById(\"modal-search-overlay\") as HTMLDivElement;\r\n      modalOverlay.addEventListener(\"click\", CloseSearch);\r\n\r\n      const modalDialog = document.getElementById(\"modal-search\") as HTMLDivElement;\r\n      modalDialog.addEventListener(\"click\", StopClick);\r\n\r\n      const modalInput = document.getElementById(\"modal-search-input\") as HTMLInputElement;\r\n      modalInput.addEventListener(\"keyup\", InitiateSearch);\r\n   }\r\n}\r\n\r\nwindow.addEventListener(\"load\", BuildFeed.BuildFeedSetup);"]}